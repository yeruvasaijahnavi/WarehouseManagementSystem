import{a as F}from"./chunk-PIV7ABIT.js";import{V as b,W as k}from"./chunk-THIE4GUI.js";import{a as D,c as M,f as T,n as L}from"./chunk-35DERIXT.js";import"./chunk-KEDPSKOD.js";import{f as w}from"./chunk-WM7ALVV2.js";import{Jb as r,Kb as e,Lb as v,Mc as P,Nc as O,Sb as x,Sc as y,Ub as h,Uc as V,Ya as n,Za as u,dc as i,ec as l,fc as m,hc as S,ib as f,ic as C,jc as I,oc as _,pb as p,qc as E,zb as d}from"./chunk-ECNHR75B.js";import"./chunk-4CLCTAJ7.js";function N(s,c){if(s&1&&(r(0,"div",9)(1,"h4"),i(2),e(),r(3,"p")(4,"strong"),i(5,"Customer:"),e(),i(6),e(),r(7,"p")(8,"strong"),i(9,"Assigned Staff:"),e(),i(10),e(),r(11,"p")(12,"strong"),i(13,"Status:"),e(),i(14),e()()),s&2){let t=h();n(2),m("Order ID: ",t.order.orderId,""),n(4),m(" ",t.order.customerId,""),n(4),m(" ",t.order.assignedStaff==null?null:t.order.assignedStaff.name,""),n(4),m(" ",t.order.status,"")}}function W(s,c){if(s&1&&(r(0,"tr")(1,"td"),i(2),e(),r(3,"td"),i(4),e(),r(5,"td"),i(6),e(),r(7,"td"),i(8),_(9,"date"),e()()),s&2){let t=c.$implicit,o=c.index;n(2),l(o+1),n(2),l(t.actionType),n(2),l(t.description),n(2),l(E(9,4,t.actionDate,"short"))}}function j(s,c){if(s&1&&(r(0,"div")(1,"table",10)(2,"thead")(3,"tr")(4,"th"),i(5,"#"),e(),r(6,"th"),i(7,"Action Type"),e(),r(8,"th"),i(9,"Description"),e(),r(10,"th"),i(11,"Action Date"),e()()(),r(12,"tbody"),p(13,W,10,7,"tr",11),e()()()),s&2){let t=h();n(13),d("ngForOf",t.auditLogs)}}function B(s,c){s&1&&(r(0,"div")(1,"p"),i(2,"No audit logs available."),e()())}var Q=(()=>{class s{constructor(t,o){this.route=t,this.orderProcessingService=o,this.order=null,this.auditLogs=[],this.statuses=["pending","assigned","packed","shipped","delivered"],this.currStatus="pending",this.progressValue=0,this.startCountdown=!1}ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t&&(this.fetchOrderDetails(t),this.currStatus=this.order.status)}fetchOrderDetails(t){this.orderProcessingService.getOrderDetails(t).subscribe({next:o=>{this.order=o.order,this.auditLogs=o.auditLogs,console.log("Order details:",o),this.calculateProgressValue()},error:o=>{console.error("Error fetching order details:",o)}})}calculateProgressValue(){return this.progressValue=(this.statuses.indexOf(this.order.status)+1)*(100/this.statuses.length),this.progressValue}updateCurrentStatus(){let t=Math.floor(this.progressValue/100*(this.statuses.length-1));this.currStatus=this.statuses[t]}startProgressUpdate(){this.intervalId=setInterval(()=>{this.progressValue<100?(this.progressValue+=20,this.updateCurrentStatus()):clearInterval(this.intervalId)},5e3)}onCheckboxChange(){this.startCountdown?this.startProgressUpdate():this.resetProgress()}resetProgress(){this.progressValue=0,this.currStatus=this.statuses[0],this.intervalId&&clearInterval(this.intervalId)}ngOnDestroy(){this.intervalId&&clearInterval(this.intervalId)}static{this.\u0275fac=function(o){return new(o||s)(u(w),u(F))}}static{this.\u0275cmp=f({type:s,selectors:[["order-processing-view"]],decls:16,vars:7,consts:[[1,"container"],[1,"my-4"],["class","mb-4",4,"ngIf"],[1,"form-check"],["type","checkbox","id","startProgressCheckbox",1,"form-check-input",3,"ngModelChange","change","ngModel"],["for","startProgressCheckbox",1,"form-check-label"],["color","success","variant","striped",3,"animated","value"],[1,"mt-4"],[4,"ngIf"],[1,"mb-4"],[1,"table","table-striped"],[4,"ngFor","ngForOf"]],template:function(o,a){o&1&&(r(0,"div",0)(1,"h2",1),i(2,"Order Details"),e(),p(3,N,15,4,"div",2),r(4,"div",3)(5,"input",4),I("ngModelChange",function(g){return C(a.startCountdown,g)||(a.startCountdown=g),g}),x("change",function(){return a.onCheckboxChange()}),e(),v(6,"label",5),e(),r(7,"h4"),i(8,"Order Progress"),e(),r(9,"c-progress-stacked")(10,"c-progress",6),i(11),e()(),r(12,"h4",7),i(13,"Order Processing History"),e(),p(14,j,14,1,"div",8)(15,B,3,0,"div",8),e()),o&2&&(n(3),d("ngIf",a.order),n(2),S("ngModel",a.startCountdown),n(5),d("animated",!0)("value",a.progressValue),n(),l(a.currStatus),n(3),d("ngIf",a.auditLogs.length>0),n(),d("ngIf",a.auditLogs.length===0))},dependencies:[V,P,O,y,k,b,L,D,M,T],encapsulation:2})}}return s})();export{Q as OrderProcessingViewComponent};
